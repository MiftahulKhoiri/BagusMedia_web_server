<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemutar Video - BAGUS MEDIA SERVER</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='video.css') }}">
</head>
<body>
    <!-- === HEADER === -->
    <header>
        <div class="logo-container">
            <img src="{{ url_for('static', filename='icon/Video.png') }}" alt="Logo Video" class="logo">
            <h1>Pemutar Video</h1>
        </div>
        <nav class="menu">
            <a href="/" class="menu-item">Home</a>
        </nav>
    </header>

    <!-- === VIDEO PLAYER FULL WIDTH === -->
    <section class="video-player-full">
        <div class="video-container">
            <video id="video-player" controls>
                Your browser does not support the video tag.
            </video>
        </div>
    </section>

    <!-- === KONTENER KONTROL + PLAYLIST === -->
    <main class="main-content">
        <div class="player-panel">
            <div class="video-info">
                <h2 id="now-playing-title">Pilih video untuk memutar</h2>
            </div>

            <!-- Kontrol Video -->
            <div class="video-controls">
                <button id="video-prev-btn" class="control-btn">‚èÆ</button>
                <button id="video-play-btn" class="control-btn play">‚ñ∂</button>
                <button id="video-pause-btn" class="control-btn">‚è∏</button>
                <button id="video-next-btn" class="control-btn">‚è≠</button>
                <button id="video-fullscreen-btn" class="control-btn">‚õ∂</button>
            </div>

            <!-- Progress Bar -->
            <div class="video-progress-container">
                <span id="video-current-time">0:00</span>
                <div class="progress-bar">
                    <div class="progress" id="video-progress"></div>
                </div>
                <span id="video-duration">0:00</span>
            </div>

            <!-- Volume -->
            <div class="video-volume-control">
                <span>üîä</span>
                <input type="range" id="video-volume-slider" min="0" max="100" value="50">
            </div>
        </div>

        <!-- === DAFTAR VIDEO === -->
        <div class="playlist-container">
            <h3>Daftar Video</h3>
            <div class="playlist" id="playlist">
                {% for file in video_files %}
                <div class="playlist-item" data-src="{{ url_for('serve_media', folder='video', filename=file) }}">
                    <span class="video-name">{{ file }}</span>
                    <button class="play-track">‚ñ∂</button>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>

    <!-- === SCRIPT === -->
    <script>
        const videoPlayer = document.getElementById('video-player');
        const videoPlayBtn = document.getElementById('video-play-btn');
        const videoPauseBtn = document.getElementById('video-pause-btn');
        const videoPrevBtn = document.getElementById('video-prev-btn');
        const videoNextBtn = document.getElementById('video-next-btn');
        const videoFullscreenBtn = document.getElementById('video-fullscreen-btn');
        const videoProgress = document.getElementById('video-progress');
        const videoCurrentTimeEl = document.getElementById('video-current-time');
        const videoDurationEl = document.getElementById('video-duration');
        const videoVolumeSlider = document.getElementById('video-volume-slider');
        const nowPlayingTitle = document.getElementById('now-playing-title');
        const playlistItems = document.querySelectorAll('.playlist-item');

        let currentVideoIndex = 0;
        const videos = Array.from(playlistItems);

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function loadVideo(index) {
            if (videos.length === 0) return;
            currentVideoIndex = index;
            const video = videos[currentVideoIndex];
            const videoSrc = video.getAttribute('data-src');
            const videoName = video.querySelector('.video-name').textContent;

            videoPlayer.src = videoSrc;
            nowPlayingTitle.textContent = videoName;
            videoProgress.style.width = '0%';
            videoCurrentTimeEl.textContent = '0:00';

            videos.forEach(item => item.classList.remove('active'));
            video.classList.add('active');

            videoPlayer.addEventListener('loadedmetadata', function() {
                videoDurationEl.textContent = formatTime(videoPlayer.duration);
            }, { once: true });

            playVideo();
        }

        function playVideo() {
            videoPlayer.play();
            videoPlayBtn.style.display = 'none';
            videoPauseBtn.style.display = 'inline-block';
        }

        function pauseVideo() {
            videoPlayer.pause();
            videoPlayBtn.style.display = 'inline-block';
            videoPauseBtn.style.display = 'none';
        }

        function nextVideo() {
            currentVideoIndex = (currentVideoIndex + 1) % videos.length;
            loadVideo(currentVideoIndex);
        }

        function prevVideo() {
            currentVideoIndex = (currentVideoIndex - 1 + videos.length) % videos.length;
            loadVideo(currentVideoIndex);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                videoPlayer.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        videoPlayBtn.addEventListener('click', playVideo);
        videoPauseBtn.addEventListener('click', pauseVideo);
        videoNextBtn.addEventListener('click', nextVideo);
        videoPrevBtn.addEventListener('click', prevVideo);
        videoFullscreenBtn.addEventListener('click', toggleFullscreen);

        videoVolumeSlider.addEventListener('input', function() {
            videoPlayer.volume = this.value / 100;
        });

        videoPlayer.addEventListener('timeupdate', function() {
            const currentTime = videoPlayer.currentTime;
            const duration = videoPlayer.duration;
            if (duration) {
                const progressPercent = (currentTime / duration) * 100;
                videoProgress.style.width = `${progressPercent}%`;
                videoCurrentTimeEl.textContent = formatTime(currentTime);
            }
        });

        document.querySelector('.video-progress-container .progress-bar').addEventListener('click', function(e) {
            const progressBar = this;
            const clickPosition = e.offsetX;
            const progressBarWidth = progressBar.offsetWidth;
            const seekTime = (clickPosition / progressBarWidth) * videoPlayer.duration;
            videoPlayer.currentTime = seekTime;
        });

        videoPlayer.addEventListener('ended', nextVideo);

        playlistItems.forEach((item, index) => {
            item.querySelector('.play-track').addEventListener('click', function() {
                loadVideo(index);
            });
        });

        if (videos.length > 0) {
            loadVideo(0);
        }
    </script>
</body>
</html>